<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="Debugging by testing assumptions - Tommy Ku&#39;s Blog - Random thoughts, stories and tutorials of a web dev" name="title" /><meta content="Web developer Tommy Ku talks about his experience in work, learning and life." name="description" /><meta content="Tommy Ku" name="author" /><meta content="Debugging by testing assumptions - Tommy Ku&#39;s Blog - Random thoughts, stories and tutorials of a web dev" property="og:title" /><meta content="article" property="og:type" /><meta content="/assets/images/banner.jpg" property="og:image" /><link href="/assets/images/author.jpg" rel="icon" type="image/png" /><link href="/atom.xml" rel="alternate" title="Tommy Ku&#39;s Method Stub" type="application/atom+xml" /><link href="https://webmention.tkcom.workers.dev/" rel="webmention" /><title>Debugging by testing assumptions - Tommy Ku&#39;s Blog</title><link href="/style/gutenberg.css" rel="stylesheet" /><link href="/style/prism.css" rel="stylesheet" /><meta content="Nanoc 4.11.15" name="generator" /></head><body><header><h2 class="h-card"><img alt="Profile pic of Tommy Ku" class="author u-photo" src="/assets/images/author.jpg" /><span class="p-name">Tommy Ku</span>'s Blog</h2><p><i>Reading and thinking</i></p></header><nav><a href="/">Index</a><a href="https://tommyku.com">About Me</a><a href="https://angel.co/tommyku">AngelList</a><a href="https://www.linkedin.com/in/tommy-chun-kit-ku-65aba999">LinkedIn</a><a rel="me" href="https://github.com/tommyku">GitHub</a><a href="/atom.xml">Feed</a></nav><main class="h-entry" id="main"><section id="meta"><h1 class="p-name">Debugging by testing assumptions</h1><i>Posted on&nbsp;<time class="dt-published" datetime="2019-02-23T00:00:00+08:00">February 23, 2019</time>&nbsp;by&nbsp;<span class="p-author">Tommy Ku</span></i><section id="old"><span class="icon">&#9888;</span><p>This post is more than 2 years old, it may contain outdated information</p></section></section><section class="e-content" id="content"><p>When troubleshooting an issue introduced not by a simple and apparent
cause, it could take from from 10 minutes all the way to hours and days,
leaving ourselves scratching our heads and nearly suffering an emotional
breakdown. However, it needs not be the case had we had a healthy mindset when
troubleshooting the issue.</p>

<blockquote>
  <p>It works on my machine
— most common excuse used by programmers</p>
</blockquote>

<p>At the beginning of troubleshooting, be an error message or something
not working the way we expect it does, we can take this assumption, and
start from here.</p>

<p>Ask yourself one question: What are the key differences between my
system and the system I am troubleshooting on?</p>

<p>As we know, computer systems nowadays are constructed as layers upon
layers of abstractions, so to troubleshoot we need to focus on each
layers as if we are peeling an onion.</p>

<p>Starting from runtime level, the key differences may be:</p>

<ul>
  <li>versions of the runtime</li>
  <li>versions of the dependencies</li>
  <li>application state (e.g. uninitialized database, config files)</li>
</ul>

<p>On layers below the application there are:</p>

<ul>
  <li>external dependencies (e.g. database, library, network and external
APIs)</li>
  <li>system level restrictions/configuration (e.g. firewall, RAM/CPU
limitation, user permissions)</li>
</ul>

<p>Then there are hardware, which is rather difficult to troubleshoot
unless we have replacement parts to see which is working/not working.</p>

<p>We should test our assumptions that every layers of the system works,
until we figured out which doesn’t. To test the assumptions, we
perform test on separate layers to ensure that they work, and move on
to the next layer.</p>

<blockquote>
  <p>We should test our assumptions that every layers of the system works,
until we figured out which doesn’t.</p>
</blockquote>

<p>Here comes a real-world example of me trying to trouble a mysterious issue
in my program — not a bug because the issue ended up to be non-code
related.</p>

<p>I upgraded my OS from Ubuntu 16.04 to Ubuntu 18.04. With it comes PHP
7.2 which is incompatible with the framework Laravel 5.5 that my
application depended on. Luckily, there is an PPA <code>ppa:ondrej/php</code> that
adds <code>php7.0</code> and related packages to Ubuntu 18.</p>

<p>Now here comes a problem. My application looks at some <code>.lock</code> files
stored in system <code>/tmp</code> folder to determine it’s state. That worked on
my Ubuntu 16.04 setup and my development environment on Docker. However,
it stopped working after the OS upgrade.</p>

<p>What gives?</p>

<p>My original thought was that the view cache was not updated, so I
cleared the caches in Laravel by running <code>php artisan cache:clear</code>. Nope
that doesn’t work. What about actually running the code? I fired up a
PHP command prompt with <code>php artisan tinker</code> and ran my line
<code>var_dump(file_exists('/tmp/something.lock'))</code> and sure enough I got
<code>bool(true)</code>. By that time I realized that I was stepping into the
WTF land of troubleshooting.</p>

<p>It was supposed to be an one-hour deployment, now it has passed the
1.5 hour mark and I still hasn’t figured out what happened. One
signature sign of you’re looking into the wrong problem is that there
aren’t many StackOverflow questions about the topic because that means
nobody was unfortunate enought to stumble upon the same problem.</p>

<p>Here is where we begin testing our assumptions. We have tested using
the PHP interpreter to see that <code>file_exists</code> works. Now we need to move
one layer up (or down depending on which way you look): Apache.</p>

<p>I will skip the dirty details and jump right to the conclusion. I did
something similar with that <code>php artisan tinker</code> step by creating a
separate PHP script inside my <code>/var/www/html</code> where my PHP pages reside.</p>

<p>Thing is, whenever I run <code>file_exists</code> by invoking a script from Apache,
it fails to recognize the file inside <code>/tmp</code>, so I can tell that
something is wrong with Apache. Further investigation by running
<code>scandir</code> tells me that from Apache’s prespective, <code>/tmp</code> is an empty
folder.</p>

<p>But why? <a href="https://unix.stackexchange.com/questions/345122/why-php-can-not-see-tmp-files">systemd - why php can not see /tmp files - Unix &amp; Linux Stack Exchange</a></p>

<p>When you ask the right question, it’s often easier to find the answer.
And that’s why I believe troubleshooting requires testing the
assumptions. By testing assumptions you can drill down layer by layer
until you located where the culprit is. Once the defect has been
identified, it’s much easier to figure out a solution.</p>

<p>Consider this approach a linear search — obviously there exists
the binary search variant called
<a href="https://en.wikipedia.org/wiki/Troubleshooting#Half-splitting">half-splitting</a>,
which I eventually had to employ on another issue that was closely
related to two pieces of hardware talking to each other.</p>
</section><section id="suggestions"><h2>You could also look at...</h2><ul id="article-list"><li><a href="../a-self-hosting-lifecycle/">A self-hosting lifecycle</a><p class="abstract">How is it like to self-host something? This post describes the process of self-hosting from the initial thought process, to patching and housekeeping, all the way to the end-of-life of a self-hosted service</p></li><li><a href="../../special/leaving-eventxtra-with-26-lessons-learned/">Leaving EventXtra with 26 lessons learned</a></li><li><a href="../i-switched-from-gnome-to-i3wm/">I switched from GNOME to i3wm</a><p class="abstract">Ubuntu 18.04 ditched Unity in favor of GNOME as the default window manager, so I switched to i3wm to desperately save some pixels on my small laptop screen</p></li></ul></section><p>This post first appeared on&nbsp;<a class="u-url" href="https://blog.tommyku.com/blog/debugging-by-testing-assumptions/" id="permalink">Tommy Ku&#39;s blog</a>. Permalink: <a class="u-url" href="https://blog.tommyku.com/blog/debugging-by-testing-assumptions/" id="permalink">https://blog.tommyku.com/blog/debugging-by-testing-assumptions/</a></p><h2>About the author</h2><section class="h-card" id="bio"><img alt="Profile pic of Tommy Ku" class="u-photo" src="/assets/images/author.jpg" /><section class="p-note"><p><i><span class="p-author">Tommy Ku</span>, a&nbsp;<span class="p-country-name">Hong Kong</span>-based&nbsp;<span class="p-job-title">Software Engineer</span>&nbsp;experienced developing PHP and Java-based web solutions and passionate in Web technology.</i></p><p><i>Also a hobbyist digital and film photographer.</i></p></section></section></main><script src="/js/prism.js" type="text/javascript"></script><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = "https://blog.tommyku.com/blog/debugging-by-testing-assumptions/";
  this.page.identifier = "debugging-by-testing-assumptions";
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//methodstub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a ,="" href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><hr /><footer></footer><a class="unloaded" href="https://blog.tommyku.com/blog/website-analytics-for-lazy-people" id="tracking-status" title="I know you viewed this page"></a><img onload="javascript: document.querySelector(&#39;#tracking-status&#39;).classList.replace(&#39;unloaded&#39;, &#39;loaded&#39;)" src="https://blog-view.tkcom.workers.dev/?https://blog.tommyku.com/blog/debugging-by-testing-assumptions/" style="width: 0px; height: 0px; margin: 0; padding: 0; visibility: hidden;" /></body></html>