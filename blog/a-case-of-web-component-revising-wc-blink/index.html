<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="A case of Web Component: Revising wc-blink - Tommy Ku&#39;s Blog - Random thoughts, stories and tutorials of a web dev" name="title" /><meta content="Web developer Tommy Ku talks about his experience in work, learning and life." name="description" /><meta content="Tommy Ku" name="author" /><meta content="A case of Web Component: Revising wc-blink - Tommy Ku&#39;s Blog - Random thoughts, stories and tutorials of a web dev" property="og:title" /><meta content="article" property="og:type" /><meta content="/assets/images/banner.jpg" property="og:image" /><link href="/assets/images/author.jpg" rel="icon" type="image/png" /><link href="/atom.xml" rel="alternate" title="Tommy Ku&#39;s Method Stub" type="application/atom+xml" /><link href="https://webmention.tkcom.workers.dev/" rel="webmention" /><title>A case of Web Component: Revising wc-blink - Tommy Ku&#39;s Blog</title><link href="/style/gutenberg.css" rel="stylesheet" /><link href="/style/prism.css" rel="stylesheet" /><meta content="Nanoc 4.11.15" name="generator" /></head><body><header><h2 class="h-card"><img alt="Profile pic of Tommy Ku" class="author u-photo" src="/assets/images/author.jpg" /><span class="p-name">Tommy Ku</span>'s Blog</h2><p><i>Reading and thinking</i></p></header><nav><a href="/">Index</a><a href="https://tommyku.com">About Me</a><a href="https://angel.co/tommyku">AngelList</a><a href="https://www.linkedin.com/in/tommy-chun-kit-ku-65aba999">LinkedIn</a><a rel="me" href="https://github.com/tommyku">GitHub</a><a href="/atom.xml">Feed</a></nav><main class="h-entry" id="main"><section id="meta"><h1 class="p-name">A case of Web Component: Revising wc-blink</h1><i>Posted on&nbsp;<time class="dt-published" datetime="2018-06-23T00:00:00+08:00">June 23, 2018</time>&nbsp;by&nbsp;<span class="p-author">Tommy Ku</span></i><section id="old"><span class="icon">&#9888;</span><p>This post is more than 2 years old, it may contain outdated information</p></section></section><section class="e-content" id="content"><p>On 2015, I wrote <code>&lt;wc-blink&gt;</code> (check it out on <a href="https://github.com/tommyku/wc-blink">GitHub</a>), a custom element that mimics the notorious
and obsolete native element <code>&lt;blink&gt;</code> (except that it has a <code>display: block</code>
instead of <code>display: inline</code> now that I think about it).</p>

<link rel="import" href="https://tommyku.github.io/wc-blink/wc-blink-element.html" async="">

<wc-blink>If your browser supports custom component and HTML import,
you‚Äôll see this blinking! (and appreciate the fact that it‚Äôs now
obsolete)</wc-blink>

<pre><code class="language-html">&lt;link rel="import" href="https://tommyku.github.io/wc-blink/wc-blink-element.html" async /&gt;

&lt;wc-blink&gt;If your browser supports custom component and HTML import, you'll see this blinking! (and appreciate the fact that it's now obsolete)&lt;/wc-blink&gt;
</code></pre>

<p>It was absoluely unnecessary to make it a web component because there
exists a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/blink">CSS-only polyfill</a>
that receives wide browser support (it‚Äôs just CSS) and requires no
JavaScript or custom element support.</p>

<p>This element was written to explore the then-v0 customer element
standard. Even today, it still sound like the future to come, where you can plug
and play any HTML element without having to convert them from front-end
frameworks such as React, Vue.js or AngularJS.</p>

<p>When I was reading Mikeal‚Äôs <a href="https://medium.com/@mikeal/ive-seen-the-future-it-s-full-of-html-2577246f2210">post on web component</a>, I was still full of
hope even though I jumped into developing in React a few months before
and never turned back. Web component is still at it‚Äôs infancy in terms
of adoption and browser supports while component-based front-end
frameworks are quickly fulfilling its promise - except the
interoperatbility part.</p>

<script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/1457_RC04/embed_loader.js"></script>

<script type="text/javascript">
  trends.embed.renderExploreWidget("TIMESERIES", {"comparisonItem":[{"keyword":"React","geo":"","time":"2015-01-01 2017-06-23"},{"keyword":"Vue","geo":"","time":"2015-01-01 2017-06-23"},{"keyword":"Web component","geo":"","time":"2015-01-01 2017-06-23"},{"keyword":"Custom element","geo":"","time":"2015-01-01 2017-06-23"}],"category":31,"property":""}, {"exploreQuery":"cat=31&date=2015-01-01%202017-06-23&q=React,Vue,Web%20component,Custom%20element","guestPath":"https://trends.google.com:443/trends/embed/"});
</script>

<p style="text-align: center;font-size: 0.8125em;">
  <i></i>
</p>

<h2 id="in-case-of-wc-blink-in-2015">In case of &lt;wc-blink&gt; in 2015</h2>

<p><code>&lt;wc-blink&gt;</code> was originally written in custom element v0, without the
ES2015 vibe of JavaScript class. Yet the general idea was the same: first you
attach a shadowDOM to the element housing your content, then fill it up
with lifecycle callbacks such as attachedCallback() or
attributeChangedCallback() which reassembles React‚Äôs componentDidMount() and a high level shouldComponentUpdate() + render() + componentDidUpdate().</p>

<pre><code class="language-html">&lt;!-- Commit: df3fcb41c880cb6762c609d7657cc0fd833d9134 --&gt;
&lt;!-- wc-blink.html --&gt;
&lt;template&gt;
  &lt;style&gt;
    /* Credit goes to google for this part
       Search "html blink" on google and see */
    @-webkit-keyframes blink {80%{opacity:0.0}}
    @keyframes blink {80%{opacity:0.0}}
    :host, * {
      -webkit-animation:blink 1s steps(1,end) 0s infinite;
      animation:blink 1s steps(1,end) 0s infinite;
    }
  &lt;/style&gt;
  &lt;content&gt;&lt;/content&gt;
&lt;/template&gt;

&lt;script&gt;
  (function() {
    // Refers to the "importer", which is index.html
    var thatDoc = document;

    // Refers to the "importee", which is src/hello-world.html
    var thisDoc =  (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

    // Gets content from &lt;template&gt;
    var template = thisDoc.querySelector('template').content;

    // Creates an object based in the HTML Element prototype
    var element = Object.create(HTMLElement.prototype);

    // Fires when an instance of the element is created
    element.createdCallback = function() {
      var shadowRoot = this.createShadowRoot();
      shadowRoot.appendChild(document.importNode(template, true));
    };

    // Fires when an instance was inserted into the document
    element.attachedCallback = function() {};

    // Fires when an instance was removed from the document
    element.detachedCallback = function() {};

    // Fires when an attribute was added, removed, or updated
    element.attributeChangedCallback = function(attr, oldVal, newVal) {};

    // Registers &lt;hello-world&gt; in the main document
    window.WcBlink = thatDoc.registerElement('wc-blink', {
        prototype: element
    });
  }());
&lt;/script&gt;
</code></pre>

<p>Of course, this is not pretty. Despite <code>&lt;template&gt;</code> reassembles the
convenient JSX where we define the HTML structure of the ‚ÄúshadowDOM‚Äù
(it isn‚Äôt exactly shadowDOM in React‚Äôs case despite some degree of
encapusulation).</p>

<p>Nevertheless, custom component v0 <code>&lt;wc-blink&gt;</code> has a much lighter
footprint compared to even the simpliest React app. All you need is a
<code>wc-blink.html</code>, and a line of <code>&lt;link rel='import' href='wc-blink.html'&gt;</code>.
No <code>npm install</code> (I used <code>git submodule add</code>). Bundling isn‚Äôt necessary
until you have multiple HTML elements to import depending on how much extra
lines of <code>&lt;link&gt;</code> you can tolerate in your HTML file.</p>

<p><code>&lt;wc-blink&gt;</code> was built as an exercise to see how the custom element
standard works. Judging from the amount of code I need to write by
myself to create an element as simple as <code>&lt;blink&gt;</code>, it wasn‚Äôt really
attractive back then. I did love the part that I could import an element
and expect it‚Äôll work like a charm, it was just that betting on a web
standard that was in drafting stage was rather reckless.</p>

<p>With such a simple component, I haven‚Äôt even got to partial shadowDOM
update (where I really hoped there was something like React‚Äôs VirtualDOM)
or inter-component communication. As the web component standard is less
opinionated than frameworks like React, <em>it gives you lots of ropes to hang
yourself</em>, ending up writing overly coupled components, unnecessary
DOM updates and weirdly behaving components due to lifecycle issue (like
things not initializing/firing properly).</p>

<h2 id="in-case-of-wc-blink-in-2018">In case of &lt;wc-blink&gt; in 2018</h2>

<p>My worry came true. Custom element v0 was removed and v1 was introduced
relying on ES2015. <code>document.registerElement</code> was no longer in the web
standard and we should expect one day no browser would support it
(Firefox never supported v0 in the first place üòê, nor v1 at the time of
writing)</p>

<p>In general, my v0 and v1 implementations of <code>&lt;wc-blink&gt;</code> are quite similar. This revision
only makes use of ES2015 class, and replaced <code>&lt;content&gt;</code> with <code>&lt;slot&gt;</code> to
give users a better idea where the dynamic content go.</p>

<pre><code class="language-html">&lt;!-- Commit: 3f8fa76675c15177baf9ccb81dcbb9b6831effcd --&gt;
&lt;!-- wc-blink-element.html --&gt;
&lt;template id='wc-blink'&gt;
  &lt;style&gt;
    /* Credit goes to google for this part
       Search "html blink" on google and see */
    @keyframes blink {80%{opacity:0.0}}
    :host, * {
      animation:blink 1s steps(1,end) 0s infinite;
    }
  &lt;/style&gt;
  &lt;slot name='content'&gt;&lt;/slot&gt;
&lt;/template&gt;

&lt;script type='text/javascript'&gt;
  // hack to get reference to this document even if calling constructors somewhere else
  const thisDoc = document.currentScript.ownerDocument;

  class WcBlink extends HTMLElement {
    constructor() {
      super();

      const template = thisDoc.getElementById('wc-blink')
        .content;

      const shadowRoot = this.attachShadow({ mode: 'open' })
        .appendChild(template.cloneNode(true));

      this.blinkStep = 0;
      this.blinkInterval = setInterval(function() {
        this.updateDisplay();
      }.bind(this), 200);
    }

    connectedCallback() {
      const content = document.createElement('div');
      content.setAttribute('slot', 'content');

      content.setAttribute('slot', 'content');
      this.childNodes.forEach((child) =&gt; content.appendChild(child));
      this.appendChild(content);
    }

    updateDisplay() {
      const content = this.querySelector('div[slot=content]');
      content.style.opacity = (this.blinkStep == 3) ? 0 : content.style.opacity;
      content.style.opacity = (this.blinkStep == 4) ? 1 : content.style.opacity;

      this.blinkStep++;
      this.blinkStep = this.blinkStep % 5;
    }
  }

  customElements.define('wc-blink', WcBlink);
&lt;/script&gt;
</code></pre>

<p>Even in 2018, tutorials on the topic are hard to find. Web component
is much less opinionated than frameworks and therefore each tutorial author has their
own way of doing things. For example, to get content <code>&lt;template&gt;</code> from
template some decided to use <code>await fetch('template.html')</code> while some
referenced the <code>link[rel="import"]</code> to get the template document when
importing the component into other documents. At the end, I figured out
a way to get a hold of the reference to <code>ownerDocument</code> even after
importing the component from other documents.</p>

<p>You may have also noticed <code>blickStep</code> and <code>updateDisplay</code>, which are
unnnecessary given that there‚Äôs a blinking animation applied to the
shadowDOM. Although the selector can select the element within the
shadowDOM (verified using <code>color: red !important;</code>), animation simply
doesn‚Äôt fire, perhaps owing to browser bug as it works on my mobile
browser but not on desktop.</p>

<p>Although adoption of web component is still low to date and there seems to
be a larger community for Polymer, I still think that going through
all the hassles to write a web component-powered app less attractive
than writing a React app in a production setting.</p>

<p>With that being said, I may still have some fun writing web components
when I am offline.</p>
</section><section id="suggestions"><h2>You could also look at...</h2><ul id="article-list"><li><a href="../using-laravel-resource-controller-with-angularjs-ngresource/">Using Laravel resource controller with AngularJS ngResource</a><p class="abstract">An example of a RESTful API-based web app using Laravel 4.2 resource controller and AngularJS 1.4 NgResource</p></li><li><a href="../have-fun-building-browser-start-page/">Have fun building browser start page</a><p class="abstract">Owning your browser's start page is a good way to keep your mood up from the work, even though most of the start pages share similar designs</p></li><li><a href="../a-self-hosting-lifecycle/">A self-hosting lifecycle</a><p class="abstract">How is it like to self-host something? This post describes the process of self-hosting from the initial thought process, to patching and housekeeping, all the way to the end-of-life of a self-hosted service</p></li></ul></section><p>This post first appeared on&nbsp;<a class="u-url" href="https://blog.tommyku.com/blog/a-case-of-web-component-revising-wc-blink/" id="permalink">Tommy Ku&#39;s blog</a>. Permalink: <a class="u-url" href="https://blog.tommyku.com/blog/a-case-of-web-component-revising-wc-blink/" id="permalink">https://blog.tommyku.com/blog/a-case-of-web-component-revising-wc-blink/</a></p><h2>About the author</h2><section class="h-card" id="bio"><img alt="Profile pic of Tommy Ku" class="u-photo" src="/assets/images/author.jpg" /><section class="p-note"><p><i><span class="p-author">Tommy Ku</span>, a&nbsp;<span class="p-country-name">Hong Kong</span>-based&nbsp;<span class="p-job-title">Software Engineer</span>&nbsp;experienced developing PHP and Java-based web solutions and passionate in Web technology.</i></p><p><i>Also a hobbyist digital and film photographer.</i></p></section></section></main><script src="/js/prism.js" type="text/javascript"></script><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = "https://blog.tommyku.com/blog/a-case-of-web-component-revising-wc-blink/";
  this.page.identifier = "a-case-of-web-component-revising-wc-blink";
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//methodstub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a ,="" href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><hr /><footer></footer><a class="unloaded" href="https://blog.tommyku.com/blog/website-analytics-for-lazy-people" id="tracking-status" title="I know you viewed this page"></a><img onload="javascript: document.querySelector(&#39;#tracking-status&#39;).classList.replace(&#39;unloaded&#39;, &#39;loaded&#39;)" src="https://blog-view.tkcom.workers.dev/?https://blog.tommyku.com/blog/a-case-of-web-component-revising-wc-blink/" style="width: 0px; height: 0px; margin: 0; padding: 0; visibility: hidden;" /></body></html>