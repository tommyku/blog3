<!DOCTYPE html><html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" /><meta content="Using Laravel resource controller with AngularJS ngResource - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" name="title" /><meta content="Web developer Tommy Ku talks about his experience in work, learning and life." name="description" /><meta content="Tommy Ku" name="author" /><meta content="Using Laravel resource controller with AngularJS ngResource - Tommy Ku&#39;s Method Stub - Random thoughts, stories and tutorials of a web dev" property="og:title" /><meta content="article" property="og:type" /><title>Using Laravel resource controller with AngularJS ngResource - Tommy Ku&#39;s Method Stub</title><link href="/style/gutenberg.css" rel="stylesheet" /><link href="/style/tomorrow-night-eighties.css" rel="stylesheet" /><meta content="Nanoc 4.8.0" name="generator" /></head><body><header><h2><img class="author" src="/assets/images/author.jpg" />Tommy Ku's Method Stub</h2><p><i>Reading and thinking</i></p></header><nav><a href="/">Index</a><a href="https://hp.tommyku.com">About Me</a><a href="https://angel.co/tommyku">AngelList</a><a href="https://hk.linkedin.com/in/tommy-ku-65aba999">LinkedIn</a><a href="https://github.com/tommyku">GitHub</a></nav><main id="main"><section id="meta"><h1>Using Laravel resource controller with AngularJS ngResource</h1><i>Posted on 2014.12.02</i></section><section id="content">
<p>Laravel provides a simplified workflow to create a RESTful application namely RESTful Resource Controllers. It allows you to generate a set of standardized controller and route RESTful interface efficiently. Meanwhile AngularJS also has a module for facilitating RESTful resource exchange. In this article we will build a simplistic quoting (i.e. record what someone said) web app called <em>OneLine</em> which looks like this:</p>

<div style="text-align: center;">
<img src="./screenshot.png" title="And now for something completely different - Monty Python">
<br>
<small><em>Img.</em> <strong>Not quite, though</strong></small>
</div>

<p>Source Code: <strong><a href="https://github.com/tommyku/oneline">on GitHub</a></strong></p>

<h3 id="the-structure">The Structure</h3>

<p>The back end is simple, there is only one object of interest per se namely “Quote”.</p>

<table>
  <thead>
    <tr>
      <th>Quote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>+ id: integer</td>
    </tr>
    <tr>
      <td>+ quote: string</td>
    </tr>
    <tr>
      <td>+ author: string</td>
    </tr>
    <tr>
      <td>+ image: string</td>
    </tr>
  </tbody>
</table>

<p>That means in Laravel, we will implement the logics (controller, model, database table and routes) around this “Quote” object. We will get down to the implementations soon.</p>

<p>The front end can get quite structured and easy to understand when ngResource, ui-router and $broadcast are used. In <em>OneLine</em>, there are 3 views: Quote list, View quote and Write quote.</p>

<table>
  <thead>
    <tr>
      <th>Quote list</th>
      <th>View quote</th>
      <th>Write quote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="./5b2fc7bb-d30a-420b-9eb6-47205052c9f1.png" title="screenshot of quote list screen"></td>
      <td><img src="./aef04f18-c5fb-4408-ad7b-7e634a14aa50.png" title="screenshot of viewing quote, basically text overlay over an backdrop image"></td>
      <td><img src="./dd7f44cd-ae8f-4531-bfd0-37e90b9e482a.png" title="screenshot of posting quote, 3 input textbox and a submit button"></td>
    </tr>
  </tbody>
</table>

<p>Each of these views, or <em>states</em> are defined with ui-router and the “Quote” object are exchanged with the server via a RESTful interface using ngResource. The operation may seem trivial when looking at the views separately, but when joining the views together the transaction can get a little bit complex as it involves exchange of “Quote” object across views.</p>

<p>Having introduced the front/back end, what is left is the RESTful API. I wasn’t lying about the convenience of using Laravel’s resource controller. According to <a href="http://laravel.com/docs/4.2/controllers#restful-resource-controllers">Laravel documentation</a> a standardized RESTful API can be defined only by one line of code.</p>

<pre><code class="language-php">Route::resource('qoute','QuoteController');
</code></pre>

<p>Or 3 lines if you insist.</p>

<pre><code class="language-php">Route::resource(
    'quote',
    'QuoteController'
);
</code></pre>

<p>Using 1 (or 3) lines of code we have already defined a set of routes as follows:</p>

<table>
  <thead>
    <tr>
      <th>Verb</th>
      <th>Path</th>
      <th>Action</th>
      <th>Route Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>/quote</td>
      <td><strong>index</strong></td>
      <td>quote.index</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/quote/create</td>
      <td>create</td>
      <td>quote.create</td>
    </tr>
    <tr>
      <td>POST</td>
      <td>/quote</td>
      <td><strong>store</strong></td>
      <td>quote.store</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/quote/{quote}</td>
      <td>show</td>
      <td>quote.show</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/quote/{quote}/edit</td>
      <td>edit</td>
      <td>quote.edit</td>
    </tr>
    <tr>
      <td>PUT/PATCH</td>
      <td>/quote/{quote}</td>
      <td>update</td>
      <td>quote.update</td>
    </tr>
    <tr>
      <td>DELETE</td>
      <td>/quote/{quote}</td>
      <td>destroy</td>
      <td>quote.destroy</td>
    </tr>
  </tbody>
</table>

<p>We only need 2: <em>index</em> and <em>store</em>. We will get to the part excluding other routes and just take these 2.</p>

<h3 id="the-laravel-part">The Laravel part</h3>

<p><img src="./laravel-text-logo.png" alt="laravel logo" width="250px" style="margin: 0;"></p>

<ol>
  <li><a href="#resource-controller">Resource controller</a></li>
  <li><a href="#routes">Routes</a></li>
  <li><a href="#migration">Migration files</a></li>
  <li><a href="#model">Model</a></li>
  <li><a href="#putting-them-together">Putting them together</a></li>
</ol>

<p>For Laravel setup, please refer to <a href="http://blog.tommyku.com/blog/create-simple-contact-list-application-with-laravel-and-openshift-integration-part-1">a previous tutorial</a> which is a good place to getting started with Laravel.</p>

<h4 id="a-nameresource-controllera-resource-controller">
<a name="resource-controller"></a> Resource controller</h4>

<p>Normally we create a controller under <code>app/controllers/</code> by extending the <em>BaseController</em> class already defined there. To define a resource controller, we use <code>artisan</code>.</p>

<p>Under Laravel root,</p>

<pre><code class="language-bash">php artisan controller:make QuoteController --only=index,store
</code></pre>

<p>Note <code>--only=index,store</code> restricts the generator to generate only 2 respective methods inside <em>QuoteController</em>.</p>

<pre><code class="language-php">&lt;?php

/* app/controllers/QuoteController.php */

class QuoteController extends \BaseController {

	/**
	 * Display a listing of the resource.
	 *
	 * @return Response
	 */
	public function index()
	{
		//
	}

	/**
	 * Store a newly created resource in storage.
	 *
	 * @return Response
	 */
	public function store()
	{
		//
	}

}
</code></pre>

<p>As for the implementations, we will leave them as is for the moment and come back later after writing migrations and model of the “Quote” object.</p>

<h4 id="a-nameroutesa-routes">
<a name="routes"></a> Routes</h4>

<pre><code class="language-php">&lt;?php

/* app/routes.php */

Route::get('/', function()
{
    return View::make('app');
});

Route::resource(
    'quote', 
    'QuoteController',
    ['only' =&gt; ['store', 'index']]
);
</code></pre>

<p>I insist to make use 4 lines for the resource route. The 3rd parameter restricts what route to be defined as we need only <em>store</em> and <em>index</em>. At least, it saves us the trouble of conceiving the route names and controller method names.</p>

<p>The ordinary <code>GET /</code> route up there is the entry point of our web app, where the AngularJS web app itself is delivered to the client.</p>

<h4 id="a-namemigrationa-migration-files">
<a name="migration"></a> Migration files</h4>

<p><a href="http://laravel.com/docs/4.2/migrations">Migration and seeding</a> is a great way to deploy your app to a new environment by running <code>artisan migrate</code> command. Laravel migration has other awesome features for you to discover. In this tutorial, we just focus on building database tables. Before actually doing that, make sure you have <code>app/config/database.php</code> well configured.</p>

<p>First we need to create a migration:</p>

<pre><code class="language-bash">php artisan migrate:make create_quotes_table --table=quotes
</code></pre>

<p>Open the migration file in <code>app/database/migrations/DATE_OF_YOUR_MIGRATION_create_quotes_table.php</code>, and write things like:</p>

<pre><code class="language-php">&lt;?php

use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreateQuotesTable extends Migration {

    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('ol_quotes', function(Blueprint $t)
        {
            $t-&gt;increments('id');
            $t-&gt;string('quote');
            $t-&gt;string('author');
            $t-&gt;string('image');
            $t-&gt;timestamps();
            $t-&gt;softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('ol_quotes');
    }

}
</code></pre>

<p>The method <em>up()</em> defines what should be done when running this migration, and <em>down()</em> reverts it. With migrations you do not even have to write SQL, just call the functions as in <em>up()</em>. You may refer to <a href="http://laravel.com/docs/4.2/schema">Laravel Schema Builder</a> for creating fields of other data types.</p>

<p>To run the migration, we use <code>artisan</code>.</p>

<pre><code class="language-bash">php artisan migrate
</code></pre>

<h4 id="a-namemodela-model">
<a name="model"></a> Model</h4>

<p>Laravel 4.2 does not come with a model generator, though someone has <a href="https://github.com/JeffreyWay/Laravel-4-Generators">implemented and open sourced it</a>. In this tutorial, we stick to the basic Laravel, thus we need to write the model ourselves. “Quote” object is on its own, without clumsy hasOne/hasMany/belongsTo relations, so its model should look simple.</p>

<pre><code class="language-php">&lt;?php

/* app/models/Quote.php */

use Illuminate\Database\Eloquent\SoftDeletingTrait;

class Quote extends Eloquent {

    use SoftDeletingTrait;

    protected $dates = ['deleted_at'];

    protected $table = 'ol_quotes';

    protected $hidden = ['created_at', 'updated_at', 'deleted_at'];

    protected $fillable = ['quote', 'author', 'image'];

}
</code></pre>

<p>The model does look simple. Easily you can map the respective fields with the columns in the database table.</p>

<h4 id="a-nameputting-them-togethera-putting-them-together">
<a name="putting-them-together"></a> Putting them together</h4>

<p>Now we have had everything needed to get the back end running, it is time to go back to <em>QuoteController</em>.</p>

<pre><code class="language-php">&lt;?php

/* app/controllers/QuoteController.php */

class QuoteController extends \BaseController {

    /**
     * Display a listing of the resource.
     *
     * @return Response
     */
    public function index()
    {
        // $sp means how many posts to skip,
        // use this for infinite scrolling
        if (!Input::has('sp')) {
            $sp = 0;
        } else {
            $sp = intval(Input::get('sp'));
        }
        
        return Response::json([
            'sp' =&gt; intval($sp)+10,
            'quotes' =&gt; Quote::orderBy('created_at', 'desc')-&gt;skip($sp)-&gt;take(10)-&gt;get()
        ]);
    }

    /**
     * Show the form for creating a new resource.
     *
     * @return Response
     */
    public function store()
    {
        // validate input
        if (!Input::has('quote')) {
            return Response::make('Bad Request', 400);
        }

        // write records
        // 'John Doe' said it if nobody said it, 
        // stub the backdrop image if no image is given
        $quote = Quote::create([
            'quote' =&gt; Input::get('quote'),
            'author' =&gt; (Input::has('author')) ? Input::get('author') : 'John Doe',
            'image' =&gt; (Input::has('image')) ? Input::get('image') : asset('res/stub.png')
        ]);

        // done
        return Response::make($quote);
    }

}
</code></pre>

<p>The workflow suggested about tries to minimize the time required to introduce a resource to the system. This setup above will make more sense when you get to handle a bigger system, where multiple RESTful resources are to be handled.</p>

<h3 id="the-angularjs-part">The AngularJS part</h3>

<p><img src="./AngularJS_logo.png" alt="angularjs logo" width="250px" style="margin: 0;"></p>

<ol>
  <li><a href="#ngprerequisites">Prerequisites</a></li>
  <li><a href="#ngroutes">Routes</a></li>
  <li><a href="#ngresource">Resource</a></li>
  <li>
<a href="#ngviews">Views</a>
    <ol>
      <li><a href="#ngquotelist">Quote list</a></li>
      <li><a href="#ngviewquote">View quote</a></li>
      <li><a href="#ngwritequote">Write quote</a></li>
    </ol>
  </li>
</ol>

<p>Unlike Laravel I have not talked about Angular JS in this blog before. Grab a tutorial or two if you feel confused in the following part.</p>

<p>Little secret, the two colors <span style="color: #d91d15 ;">Fire Engine Red</span> and <span style="color: #a3130c">Sangria</span> used in the app’s header actually came from Angular’s logo.</p>

<h4 id="a-namengprerequisitesa-prerequisites">
<a name="ngprerequisites"></a> Prerequisites</h4>
<p><em>OneLine</em> makes use of a couple AngularJS libraries and JQuery, to get them properly, I suggest that you use bower (<a href="http://bower.io/">grab bower</a>).</p>

<p>To get all our dependencies ready, run</p>

<pre><code class="language-bash">bower install angular angular-resource jquery ngInfiniteScroll angular-ui-router
</code></pre>

<p>Don’t forget to include them in your <code>app/views/app.php</code>, this is the app’s entry point when user first visit the site.</p>

<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;!-- app/view/app.php --&gt;
&lt;html ng-app="link"&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /&gt;

        &lt;title&gt;Quote - random quote for your inspiration&lt;/title&gt;

        &lt;meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" /&gt;
        &lt;meta name="description" content="Light-weight search engine for stored links" /&gt;

        &lt;script type="text/javascript" src="js/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/angular/angular.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/angular-ui-router/release/angular-ui-router.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/angular-resource/angular-resource.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/ngInfiniteScroll/build/ng-infinite-scroll.min.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/app.js"&gt;&lt;/script&gt;

        &lt;link rel="shortcut icon" href="" /&gt;
        &lt;link rel="apple-touch-icon" href="" /&gt;

        &lt;link rel="stylesheet" href="css/base.css" /&gt;
        &lt;link rel="stylesheet" href="css/animate.css" /&gt;

    &lt;/head&gt;
    &lt;body ui-view&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h4 id="a-namengroutesa-routes">
<a name="ngroutes"></a> Routes</h4>
<p>Like Laravel’s <code>route.php</code>, AngularJS has its way of defining paths and they can be seens as <code>Activity</code> in Android apps. The <code>&lt;body&gt;</code> tag containing the directive <code>ui-view</code> serves as a container of content provided by each path, where their templates defined in a separate folder <code>/partials</code></p>

<p>To define the paths, or states, it looks something like this.</p>

<pre><code class="language-javascript">var app = angular.module("link", ['ui.router', 'ngResource', 'infinite-scroll', 'monospaced.elastic']);

/* js/app.js */

/* something else :p */

app.config(function($stateProvider, $urlRouterProvider) {
  $stateProvider
    .state('main', {
      url: '/',
      templateUrl: 'partials/main.html',
      controller: 'mainCtrl'
    })
    .state('post', {
      url: '/post',
      templateUrl: 'partials/post.html',
      controller: 'postCtrl'
    })
    .state('view', {
      url: '/view/?params',
      templateUrl: 'partials/view.html',
      controller: 'viewCtrl'
    });

  // defaul route
  $urlRouterProvider.otherwise('/');
});
/* something else :p */
</code></pre>

<p>Breaking each state down, we have.</p>

<pre><code class="language-javascript">// define a new state
$stateProvider
  .state('main', {
    url: '/', // this is shown on the location bar
    templateUrl: 'partials/main.html', // url to template of the view
    // each view has its own controller
    // passing data across controllers can be trickly, more later
    controller: 'mainCtrl'
  })
</code></pre>

<p>I do not see the need of explaining what is inside <code>partials/main.html</code> so I am just posting its content as an example.</p>

<!-- I should really get a syntax hightlighter -->

<pre><code class="language-html">&lt;header id="header"&gt;
  &lt;div id="app-name"&gt;
    Quote
    &lt;span class="header-btn pull-right" ui-sref="post"&gt;Post&lt;/span&gt;
  &lt;/div&gt;
&lt;/header&gt;

&lt;ul class="main-list"&gt;
  &lt;li class="link-block animated fadeInUp" ng-repeat="item in pack"  style="-webkit-animation-delay:{{$index%10*0.1}}s; animation-delay:{{$index%10*0.1}}s;" ng-click="goToView(item)"&gt;
    &lt;a title="{{item.author}}"&gt;
      &lt;div class="data-wrapper"&gt;
        &lt;div class="quote" data-ldquo="&amp;ldquo;" data-rdquo="&amp;rdquo;"&gt;{{item.quote}}&lt;/div&gt;
        &lt;div class="author ng-binding" style="padding-left: 0; margin-top: 0.2em;"&gt;{{item.author}}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/a&gt; 
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div infinite-scroll="fetch()" infinite-scroll-distance="3"&gt;&lt;/div&gt;
</code></pre>

<h4 id="a-namengresourcea-resource">
<a name="ngresource"></a> Resource</h4>

<p>ngResource provides an inteface for manipulating a resource using RESTful API provided by the back end. In <em>OneLine</em>, there is only one resource, Quote object. We want to define it in a factory so it is reusable across controllers.</p>

<pre><code class="language-javascript">/* js/app.js */
/* something else :p */
app.factory('Quote', function($resource) {
  return $resource(
    'quote', 
    null,
    {
      'get': {
        'method': "GET",
        'params': {
          'sp': '0'
        }
      }
    }
  );
});
/* something else :p */
</code></pre>

<p>ngResource’s documentation and examples are rather insufficient so you may need to experiment with it serveral time before getting it work. In the factory, a resource is simply returned, first parameter being the URL to the resource, second parameter is an object defining the default paramters, the third parameter is an object for extra methods and routes.</p>

<p>To use a resource created by a factory, see the following examples.</p>

<p><strong>Getting a list of quotes, skip elements by <em>sp</em></strong></p>

<pre><code class="language-javascript">var quote = new Quote();
quote.$get({'sp': $scope.sp})
  .then(function(response) {
    $scope.sp = response.sp;
    console.log(response);
    $scope.pack = $scope.pack.concat(response.quotes);
    $rootScope.$broadcast('fetch-done');
    if (response.quotes.length == 0) {
      $rootScope.$broadcast('fetch-nomore');
    }
  })
  .catch(function(response) {
    $rootScope.$broadcast('fetch-fail');
  });
</code></pre>

<p><strong>Posting a quote</strong></p>

<pre><code class="language-javascript">var quote = new Quote($scope.quote); 
// $scope.quote contains the parameters to be passed
quote.$save()
  .then(function(response) {
    console.log(response);
    $rootScope.$broadcast('post-done');
  })
  .catch(function(response) {
    console.log(response);
    $rootScope.$broadcast('post-fail');
  });
</code></pre>

<p>The general working is like: (1) instantiate a resource object; (2) set parameter; (3) invoke the respective method to make a RESTful call; (4) process the result or catch if there is an error (like success and error handlers in jQuery)</p>

<h4 id="a-namengviewsa-views">
<a name="ngviews"></a> Views</h4>

<p>Lastly, we need to link things up. In this part we will look at the templates and the controllers for each view, and how user navigate from one to another. It feels like using <code>Intent</code> to move between views, but much simplier and possible a bit more troublesome in passing data. Scroll down to learn more.</p>

<h5 id="a-namengquotelista-quote-list">
<a name="ngquotelist"></a> Quote list</h5>

<center>
<img src="./5b2fc7bb-d30a-420b-9eb6-47205052c9f1.png" style="width: 100%; max-width: 400px;" title="screenshot of quote list screen">
</center>

<pre><code>&lt;!-- In partials/main.html --&gt;
&lt;header id="header"&gt;
  &lt;div id="app-name"&gt;
    Quote
    &lt;span class="header-btn pull-right" ui-sref="post"&gt;Post&lt;/span&gt;
  &lt;/div&gt;
&lt;/header&gt;

&lt;ul class="main-list"&gt;
  &lt;li class="link-block animated fadeInUp" ng-repeat="item in pack"  style="-webkit-animation-delay:{{$index%10*0.1}}s; animation-delay:{{$index%10*0.1}}s;" ng-click="goToView(item)"&gt;
    &lt;a title="{{item.author}}"&gt;
      &lt;div class="data-wrapper"&gt;
        &lt;div class="quote" data-ldquo="&amp;ldquo;" data-rdquo="&amp;rdquo;"&gt;{{item.quote}}&lt;/div&gt;
        &lt;div class="author ng-binding" style="padding-left: 0; margin-top: 0.2em;"&gt;{{item.author}}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;
&lt;div infinite-scroll="fetch()" infinite-scroll-distance="3"&gt;&lt;/div&gt;
</code></pre>

<p>List items are inserted into the list by the useful and common <code>ng-repeat</code>, which references to a variable <code>pack</code> within the scope.</p>

<p>At the bottom there is a tag calling the method <code>fetch()</code> whenever the user scroll near that &lt;div&gt;, serving the purpose of infinite scrolling.</p>

<p>Now, the controller.</p>

<pre><code class="language-javascript">app.controller("mainCtrl", function($scope, Quote, $rootScope, $state) {
  $scope.sp = 0;
  $scope.nomore = false;
  $scope.loading = false;
  $scope.pack = [];

  $scope.fetch = function() {
    if ($scope.nomore || $scope.loading) {
      return;
    }

    $rootScope.$broadcast('fetch-initiate');
    var quote = new Quote();
    quote.$get({'sp': $scope.sp})
      .then(function(response) {
        $scope.sp = response.sp;

        console.log(response);

        $scope.pack = $scope.pack.concat(response.quotes);

        $rootScope.$broadcast('fetch-done');

        if (response.quotes.length == 0) {
          $rootScope.$broadcast('fetch-nomore');
        }
      })
      .catch(function(response) {
        $rootScope.$broadcast('fetch-fail');
      });
  };

  $scope.goToView = function(item) {
    var param = angular.toJson(item);
    $state.go('view', {params: param});
  };

  $scope.$on('fetch-initiate', function(e, data) {
    $scope.loading = true;
    console.log('fetch initiated');
  });

  $scope.$on('fetch-done', function(e, data) {
    $scope.loading = false;
    console.log('fetch done');
  });

  $scope.$on('fetch-fail', function(e, data) {
    console.log('fetch failed');
  });

  $scope.$on('fetch-nomore', function(e, data) {
    $scope.nomore = true;
    console.log('fetch nomore');
  });
});
</code></pre>

<p>Note that in the parameter list, <code>function($scope, Quote, $rootScope, $state)</code>, <code>Quote</code> has been injected, along with <code>$rootScope</code> and <code>$state</code>.</p>

<p>The usage of <code>Quote</code> has been stated <a href="#ngresource">above</a>. Here we are looking at two interesting things: <code>$rootScope</code> and <code>$state</code>.</p>

<p><code>$rootScope</code> allows you to define a custom “event” that you are broadcasting like throwing exceptions, but it works backwards, from the top of scope tree to the bottom. It feels like defining functions for specific occasions yet it makes more sense this way as the call will be “broadcasted” throughtout the scope tree.</p>

<p><code>$state</code> here is primarily for transitioning to another state. <code>$state.go('view', {params: param})</code> leads the user to the “View quote” state and passes some parameters along the way. This is a easier way to pass unsensitive and simple data across states in AngularJS and there is a more elegant way not covered in this article. Scroll down to the appendix <a href="#servicesingleton">use service singleton to pass parameters across controllers</a> to view it.</p>

<h5 id="a-namengviewquotea-view-quote">
<a name="ngviewquote"></a> View quote</h5>

<center>
<img src="./aef04f18-c5fb-4408-ad7b-7e634a14aa50.png" style="width: 100%; max-width: 400px;" title="screenshot of viewing quote, basically text overlay over an backdrop image">
</center>

<pre><code class="language-html">&lt;!-- partials/view.html --&gt;
&lt;div class="animated fadeIn fullScreen fullScreen-bg"
     style="background-image:url({{quote.image}});"&gt;
  &lt;div class="centerQuote"&gt;
    &lt;h1 class="quote" data-ldquo="&amp;ldquo;" data-rdquo="&amp;rdquo;"&gt;{{quote.quote}}&lt;/h1&gt;
    &lt;em class="author"&gt;{{quote.author}}&lt;/em&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>When a user select a quote from the main view or post a new quote, the user will be directed to this “view” state. Parameters to this page are the <code>image</code>, <code>quote</code> and <code>author</code> presented in this template respectively.</p>

<p>How do we get the parameters?</p>

<pre><code class="language-javascript">app.controller("viewCtrl", function($scope, $rootScope, $stateParams) {
  $scope.quote = angular.fromJson($stateParams.params);
});
</code></pre>

<p>One simply reads them from <code>$stateParams</code>. Note that this example omits validations for simplexity. In the appendix there is a more elegant way <a href="#servicesingleton">using angular service</a>.</p>

<h5 id="a-namengwritequotea-write-quote">
<a name="ngwritequote"></a> Write quote</h5>

<center>
<img src="./dd7f44cd-ae8f-4531-bfd0-37e90b9e482a.png" style="width: 100%; max-width: 400px;" title="screenshot of posting quote, 3 input textbox and a submit button">
</center>

<pre><code class="language-html">&lt;!-- partials/post.html --&gt;
&lt;header id="header"&gt;
  &lt;div id="app-name"&gt;
    &lt;span class="header-btn pull-left" ui-sref="main"&gt;Back&lt;/span&gt;
    Quote
    &lt;span class="header-btn pull-right" ng-click="post()"&gt;Submit&lt;/span&gt;
  &lt;/div&gt;
&lt;/header&gt;

&lt;div class="content"&gt;
  &lt;div class="link-block"&gt;
    &lt;input type="text" ng-model="quote.quote" placeholder="QUOTE" class="msd-elastic" ng-disabled="disabled" /&gt;
  &lt;/div&gt;

  &lt;div class="link-block"&gt;
    &lt;input type="text" ng-model="quote.author" placeholder="BY" class="ng-pristine ng-valid ng-touched" ng-disabled="disabled"&gt;
  &lt;/div&gt;

  &lt;div class="link-block"&gt;
    &lt;input type="text" ng-model="quote.image" placeholder="BACKDROP" class="ng-pristine ng-valid ng-touched" ng-disabled="disabled"&gt;
  &lt;/div&gt;
  &lt;div class="clearfix"&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>To move from one state to another, there is a directive called <code>ui-sref</code> in the Back button above so you can move to another state without passing any parameter, but if you do you will need to define a function under the scope like <code>ng-click="post()"</code> to capture the values and pass it with <code>$state.go()</code>.</p>

<pre><code class="language-javascript">app.controller("postCtrl", function($scope, Quote, $rootScope, $state) {
  $scope.disabled = false;

  $scope.quote = {
    'quote': '',
    'author': '',
    'image': ''
  };

  $scope.post = function() {
    $rootScope.$broadcast('post-start');

    var quote = new Quote($scope.quote);
    quote.$save()
      .then(function(response) {
        console.log(response);
        $rootScope.$broadcast('post-done');
      })
      .catch(function(response) {
        console.log(response);
        $rootScope.$broadcast('post-fail');
      });
  };

  $scope.$on('post-start', function(e, data) {
    $scope.disabled = true;
  });

  $scope.$on('post-done', function(e, data) {
    // done and go to see the detail
    $state.go('view', {params: angular.toJson($scope.quote)});
  });

  $scope.$on('post-fail', function(e, data) {
    // enable the input
    $scope.disabled = false;
  });
});
</code></pre>

<p>Note the line <code>$state.go('view', {params: angular.toJson($scope.quote)});</code>, one cannot simply go to another state by using <code>ui-sref</code> if one needs to pass some parameters.</p>

<h3 id="conclusion">Conclusion</h3>

<p>This article aims to helping one getting started with Larvel resource controller and AngularJS ngResource because they are great ways to save time in developing RESTful interactions. The practices used are not necessarily the best implementations as I am also still learning, kindly please correct me in the comment section if I am wrong.</p>

<p>In the next planned article I am getting into Laravel Auth and Blade templating, so stay tuned!</p>

<h3 id="references">References</h3>

<ol>
  <li><a href="http://laravel.com/docs/4.2/controllers#restful-resource-controllers">Laravel - The PHP Framework For Web Artisans. (RESTful Resource Controllers)</a></li>
  <li><a href="http://laravel.com/docs/4.2/migrations">Laravel - The PHP Framework For Web Artisans. (Migrations &amp; Seeding)</a></li>
  <li><a href="https://docs.angularjs.org/api/ngResource">AngularJS Documentation for ngResource</a></li>
</ol>

<h3 id="appendix">Appendix</h3>

<h4 id="a-nameservicesingletona-use-service-singleton-to-pass-parameters-across-controllers">
<a name="servicesingleton"></a> Use service singleton to pass parameters across controllers</h4>

<p>When passing parameters among AngularJS controllers, they cannot be simply passed. One way to do so is to define a service singleton which has the same state across all its instances. Defining a service feels like defining a class, one defines its attributes and methods, and return a reference to itself.</p>

<pre><code class="language-javascript">app.service("PostService", function() {
  var post = {};
  var setPost = function(obj) {
    post = obj;
  };
  var getPost = function() {
    return post;
  };
  return {
    setPost: setPost,
    getPost: getPost
  };
});
</code></pre>

<p>This example constructs a simple service for passing a “Post” across controllers, with one attribute containing the post itself, and a mutator and accessor for that object.</p>

<p>To make the changes to the object effective, though, we need to put them into the scope under the controller.</p>

<pre><code class="language-javascript">/* inside a controller */
$scope.$PostService = PostService;
</code></pre>

<p>Then you can convenient call the mutator and accessor of the <code>PostService</code> knowing its change will reflect in any other controller.</p>

<pre><code class="language-javascript">/* in one controller*/
$scope.$PostService = PostService;
$scope.$PostService.setPost({"title": "hello", "content": "world"});
console.log($scope.$PostService.getPost());
// gives {"title": "hello", "content": "world"}
</code></pre>

<pre><code class="language-javascript">/* in another controller*/
$scope.$PostService = PostService;
console.log($scope.$PostService.getPost());
// also gives {"title": "hello", "content": "world"}
</code></pre>

<p>As an appendix I am not going to further details than just making it work, but if you are interested, <a href="https://rclayton.silvrback.com/passing-state-via-services">someone has written a great article explaining the use of service</a>.</p>

<p>Stay tuned to <a href="http://blog.tommyku.com">Method Stub</a> as I may will post more Laravel/AngularJS articles very soon!</p>
</section></main><script src="/js/highlight.pack.js" type="text/javascript"></script><script>(function() {
  hljs.initHighlightingOnLoad();

}).call(this);
</script><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = "https://blog.tommyku.com/blog/using-laravel-resource-controller-with-angularjs-ngresource/";
  this.page.identifier = "using-laravel-resource-controller-with-angularjs-ngresource";
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = '//methodstub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a ,="" href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47055557-3', 'auto');
ga('send', 'pageview');</script></body></html>